<div class="flex justify-between items-center" style="margin-bottom: 2rem;">
  <h2>Weekly Room Overview</h2>
  <button class="btn" routerLink="/reservations/new">Book a Room</button>
</div>

<div class="calendar-scroll-container">
  <div class="calendar-wrapper">
    <!-- Time Labels Column -->
    <div class="time-column">
       <div class="time-header-space"></div>
       <div class="time-labels-container">
          <div class="time-label" *ngFor="let t of timeLabels" [style.height.px]="60 * PIXELS_PER_MINUTE">
             <span style="position: relative; top: -10px;">{{ t }}</span>
          </div>
       </div>
    </div>
    
    <!-- Weeks -->
    <div class="week-group" *ngFor="let w of weeks">
       <div class="week-header">{{ w.name }}</div>
       <div class="days-row">
          <div class="day-column" *ngFor="let d of w.days">
             <div class="day-header">
                <div>{{ d.name }}</div>
                <div class="day-date">{{ d.date | date:'mediumDate' }}</div>
             </div>
             
             <div class="day-grid-container"
                  (mousedown)="onMouseDown($event, d)"
                  (mousemove)="onMouseMove($event, d)"
                  (mouseup)="onMouseUp($event, d)"
                  (mouseleave)="isDragging = false">

                <!-- Drag Selection Overlay -->
                <div *ngIf="isDragging && dragDay === d"
                     class="drag-selection-box"
                     [style.top.px]="getDragBoxTop()"
                     [style.height.px]="getDragBoxHeight()">
                </div>

                <!-- Background grid lines -->
                <div class="grid-line" *ngFor="let t of timeLabels" [style.height.px]="60 * PIXELS_PER_MINUTE"></div>
                
                <!-- Reservations -->
                <div *ngFor="let r of d.reservations" 
                     class="reservation-card"
                     [ngClass]="r.type === 'BUFFER' ? 'res-buffer' : 'res-normal'"
                     [style.top.px]="getTopPos(r)"
                     [style.height.px]="getHeight(r)">
                     
                   <div *ngIf="r.type === 'BUFFER'; else normalContent" class="buffer-content">
                      TSP Buffer
                   </div>
                   <ng-template #normalContent>
                      <div class="res-title" [title]="r.activity">{{ r.activity }}</div>
                      <div class="res-body">{{ r.startTime | date:'shortTime' }} - {{ r.endTime | date:'shortTime' }}</div>
                      <div class="res-body">User: {{ r.user?.name || 'TSP System' }}</div>
                      <div class="res-body" *ngIf="getHeight(r) > 50">HW: {{ r.hardware }}</div>
                      <div class="res-actions" *ngIf="canModify(r)">
                         <button (click)="editReservation(r.id)" title="Edit">✎</button>
                         <button (click)="deleteReservation(r.id, $event)" title="Cancel">✖</button>
                      </div>
                   </ng-template>
                </div>
             </div>
          </div>
       </div>
    </div>

  </div>
</div>
